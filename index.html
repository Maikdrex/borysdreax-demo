<script>
  let scene, camera, renderer, avatar, shirtMesh;

  init();
  animate();

  function init() {
    scene = new THREE.Scene();
    camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.set(0, 1.6, 3);

    renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    const controls = new THREE.OrbitControls(camera, renderer.domElement);

    // Luces
    scene.add(new THREE.HemisphereLight(0xffffff, 0x444444, 1.2));
    const dirLight = new THREE.DirectionalLight(0xffffff, 1);
    dirLight.position.set(5, 10, 7.5);
    scene.add(dirLight);

    // Cargar modelo GLB
    const loader = new THREE.GLTFLoader();
    loader.load("avatar_con_prenda.glb", function (gltf) {
      avatar = gltf.scene;
      scene.add(avatar);

      // Buscar la prenda en el modelo
      avatar.traverse((child) => {
        if (child.isMesh && child.name.toLowerCase().includes("shirt")) {
          shirtMesh = child;

          // Crear textura con "BX"
          const texture = createBXTexture();

          // Asignar material 3D a la camiseta
          shirtMesh.material = new THREE.MeshStandardMaterial({
            map: texture,
            metalness: 0.1,
            roughness: 0.8,
          });
        }
      });
    });
  }

  function createBXTexture() {
    const size = 1024;
    const canvas = document.createElement("canvas");
    canvas.width = size;
    canvas.height = size;
    const ctx = canvas.getContext("2d");

    // Fondo blanco
    ctx.fillStyle = "#ffffff";
    ctx.fillRect(0, 0, size, size);

    // Logo BX en morados
    const gradient = ctx.createLinearGradient(0, 0, size, size);
    gradient.addColorStop(0, "#9d4edd");
    gradient.addColorStop(1, "#c77dff");

    ctx.fillStyle = gradient;
    ctx.font = "bold 250px Arial";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.fillText("BX", size / 2, size / 2);

    // Crear textura de Three.js
    const texture = new THREE.CanvasTexture(canvas);
    texture.wrapS = texture.wrapT = THREE.RepeatWrapping; // hace que siga las UV
    texture.repeat.set(1, 1); // puedes aumentar valores para repetir estampado
    texture.needsUpdate = true;

    return texture;
  }

  function animate() {
    requestAnimationFrame(animate);
    renderer.render(scene, camera);
  }
</script>
